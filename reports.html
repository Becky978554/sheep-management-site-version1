<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sheep Reports</title>
  <link rel="stylesheet" href="style.css">
</head>

<body class="reports-page">
  <div class="container">
    <a href="index.html" class="back">← Back</a>
    <h1>Reports</h1>

    <div id="reportImportControls" class="import-controls"
      style="margin-top:8px; display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
      <label for="csvFile"><strong>Import from CSV:</strong></label>
      <input type="file" id="csvFile" accept="text/csv">
      <label style="margin-left:8px;"><input type="checkbox" id="csvOverwrite"> Overwrite matching IDs</label>
      <button id="importCsvBtn" class="button">Import</button>
      <button id="downloadTemplate" class="button" type="button">Download CSV Template</button>
      <button id="downloadTemplateWithData" class="button" type="button">Download CSV Template (with current
        animals)</button>
    </div>

    <section id="reportControls">
      <label for="reportType"><strong>Report:</strong></label>
      <select id="reportType">
        <option value="lambingCalendarIcs">Lambing Calendar (with ICS)</option>
        <option value="lambingCalendar">Lambing Calendar</option>
        <option value="breedingHistory">Breeding History Report</option>
        <option value="lambReport">Lamb Report</option>
        <option value="weightGain">Weight Gain Report</option>
        <option value="herdReport">Herd Report</option>
        <option value="ramReport">Ram Report</option>
        <option value="eweReport">Ewe Report</option>
        <option value="sireOffspring">Sire Offspring Report</option>
        <option value="damOffspring">Dam Offspring Report</option>
        <option value="famachaBcs">FAMACHA / BCS Report</option>
        <option value="deathReport">Death Report</option>
        <option value="soldReport">Sold Report</option>
        <option value="cullReport">Cull Report</option>
        <option value="ageAsc">Age — Youngest → Oldest</option>
        <option value="ageDesc">Age — Oldest → Youngest</option>
        <option value="dueDates">Due Dates — Nearest First</option>
      </select>
      <button id="exportCsv">Export CSV</button>
      <button id="exportIcs">Export ICS</button>
      <button id="printReport" class="button">Print</button>
    </section>
    <section id="reportFilters" class="filterform" style="margin-top:12px;">
      <div class="choosenewfilter pure-g">
        <div class="filtercell pure-u-1-3">
          <label><strong>Mark / Mating Date Between</strong></label>
          <div style="margin-top:6px;"><input type="date" id="matingdate_lowerbound"> — <input type="date"
              id="matingdate_upperbound"></div>
        </div>

        <div class="filtercell pure-u-1-3" style="text-align:right;">
          <button id="generateReport2" class="button">Generate</button>
        </div>
      </div>
    </section>
    <div style="flex:1 1 auto"></div>
    </section>

    <section id="reportOutput">
      <!-- Printable area: summary + table. Print CSS will show only this block. -->
      <div id="reportPrintArea">
        <div id="reportSummary" style="margin-bottom:12px;"></div>
        <div id="reportTableContainer"></div>
      </div>
    </section>

    <hr>

    <h2>Notes / Daily Reports</h2>
    <textarea id="reportText" placeholder="Write your farm report here..."></textarea>
    <button onclick="saveReport()">Save Report</button>

    <h2>Saved Reports</h2>
    <ul id="reportList"></ul>
  </div>

  <script src="script.js"></script>
  <script>
    // Wire CSV import and template buttons on Reports page
    (function () {
      try {
        const csvFileInput = document.getElementById('csvFile');
        const importBtn = document.getElementById('importCsvBtn');
        const overwriteChk = document.getElementById('csvOverwrite');
        const downloadBtn = document.getElementById('downloadTemplate');
        const downloadWithDataBtn = document.getElementById('downloadTemplateWithData');

        if (downloadBtn) downloadBtn.addEventListener('click', () => { try { generateTemplateCsv(false); } catch (e) { console.warn(e); } });
        if (downloadWithDataBtn) downloadWithDataBtn.addEventListener('click', () => { try { generateTemplateCsv(true); } catch (e) { console.warn(e); } });

        if (importBtn && csvFileInput) {
          importBtn.addEventListener('click', () => {
            const files = csvFileInput.files;
            if (!files || files.length === 0) return alert('Please choose a CSV file to import.');
            const file = files[0];
            const reader = new FileReader();
            reader.onload = (e) => {
              const text = e.target.result;
              importSheepCsvWithPreview(text, !!(overwriteChk && overwriteChk.checked));
            };
            reader.onerror = (e) => { console.error(e); alert('Failed to read file.'); };
            reader.readAsText(file, 'utf-8');
          });
        }
      } catch (e) { console.warn('Reports import wiring failed', e); }
      // Wire Print button
      try {
        const printBtn = document.getElementById('printReport');
        if (printBtn) printBtn.addEventListener('click', () => { window.print(); });
      } catch (e) { }
    })();
  </script>
</body>

</html>